I2luY2x1ZGU8c3RkaW8uaD4NCiNpbmNsdWRlPHN0ZGxpYi5oPg0KDQovL2xpbmtl
ZCBsaXN0IG5vZGUNCnN0cnVjdCBub2RlDQp7DQogICAgaW50IGluZm87DQogICAg
c3RydWN0IG5vZGUgKmxsaW5rOw0KICAgIHN0cnVjdCBub2RlICpybGluazsNCn07
IC8vc3RydWN0dXJlIHR5cGUgZGVmaW5lIGFudGhlciBOT0RFDQp0eXBlZGVmIHN0
cnVjdCBub2RlIE5PREU7DQoNCi8vKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKg0KDQovL05PREUqIEZvciBwb2ludGVyIHRvIGlu
dGVnZXIgQ2FzdA0KTk9ERSAqbWF4aW11bShOT0RFICp4KXsNCiAgICB3aGlsZSh4
LT5ybGluayAhPSBOVUxMKXsNCiAgICAgICAgeCA9IHgtPnJsaW5rOw0KICAgIH0N
CiAgICByZXR1cm4geC0+aW5mbzsNCn0NCg0KTk9ERSAqbWluaW11bShOT0RFICp4
KXsNCiAgICB3aGlsZSh4LT5sbGluayAhPSBOVUxMKXsNCiAgICAgICAgeCA9IHgt
PmxsaW5rOw0KICAgIH0NCiAgICByZXR1cm4geC0+aW5mbzsNCn0NCg0KLy8qKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCk5P
REUgKmluc2VydChOT0RFICpyb290LCBpbnQgaXRlbSkNCnsNCiAgICBOT0RFICp0
ZW1wLCpjdXIsKnByZXY7DQoNCiAgICAvL2Zpc3QgdGltZSBhbGxvY2F0aW9uWw0K
ICAgIHRlbXA9KE5PREUgKiltYWxsb2Moc2l6ZW9mKE5PREUpKTsNCiAgICB0ZW1w
LT5pbmZvPWl0ZW07DQogICAgdGVtcC0+bGxpbms9TlVMTDsNCiAgICB0ZW1wLT5y
bGluaz1OVUxMOw0KICAgIGlmKHJvb3Q9PU5VTEwpDQogICAgICAgIHJldHVybiB0
ZW1wOw0KICAgIC8vZmlzdCB0aW1lIGFsbG9jYXRpb25dDQoNCiAgICBwcmV2PU5V
TEw7DQogICAgY3VyPXJvb3Q7DQogICAgd2hpbGUoY3VyIT1OVUxMKQ0KICAgICAg
ICB7DQogICAgICAgICAgICBwcmV2PWN1cjsNCiAgICAgICAgICAgIGlmKGN1ci0+
aW5mbyA8IGl0ZW0gKQ0KICAgICAgICAgICAgICAgIGN1cj1jdXItPnJsaW5rOw0K
ICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIGN1cj1jdXItPmxsaW5r
Ow0KDQogICAgICAgIH0NCiAgICAgICAgaWYoaXRlbTxwcmV2LT5pbmZvKQ0KICAg
ICAgICAgICAgcHJldi0+bGxpbms9dGVtcDsNCiAgICAgICAgZWxzZQ0KICAgICAg
ICAgICAgcHJldi0+cmxpbms9dGVtcDsNCiAgICAgICAgcmV0dXJuIHJvb3Q7DQp9
DQoNCi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKg0KDQpOT0RFICptaW5WYWx1ZU5vZGUoTk9ERSAqbm9kZSkNCnsNCiAgICBO
T0RFICpjdXJyZW50ID0gbm9kZTsNCi8qIGxvb3AgdG8gZmluZCB0aGUgbGVmdG1v
c3QgbGVhZiAqLw0KICAgIHdoaWxlIChjdXJyZW50LT5sbGluayAhPSBOVUxMKQ0K
ICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQtPmxsaW5rOw0KICAgIHJldHVy
biBjdXJyZW50Ow0KfQ0KDQovLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioNCg0KTk9ERSAqZGVsZXRlX2VsZW1lbnQoTk9ERSAq
cm9vdCxpbnQga2V5KQ0Kew0KICAgICAgICBpZiAocm9vdCA9PSBOVUxMKQ0KICAg
ICAgICAgICAgcmV0dXJuIHJvb3Q7DQogICAgICAgIGlmIChrZXkgPCByb290LT5p
bmZvKQ0KICAgICAgICAgICAgcm9vdC0+bGxpbmsgPSBkZWxldGVfZWxlbWVudChy
b290LT5sbGluaywga2V5KTsNCiAgICAgICAgZWxzZSBpZiAoa2V5ID4gcm9vdC0+
aW5mbykNCiAgICAgICAgICAgIHJvb3QtPnJsaW5rID0gZGVsZXRlX2VsZW1lbnQo
cm9vdC0+cmxpbmssIGtleSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsN
Ci8vIG5vZGUgd2l0aCBvbmx5IG9uZSBjaGlsZCBvciBubyBjaGlsZA0KICAgICAg
ICAgICAgICAgIGlmIChyb290LT5sbGluayA9PSBOVUxMKQ0KICAgICAgICAgICAg
ICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBOT0RFICp0ZW1wID0g
cm9vdC0+cmxpbms7DQogICAgICAgICAgICAgICAgICAgICAgICBmcmVlKHJvb3Qp
Ow0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRlbXA7DQogICAgICAg
ICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChyb290LT5y
bGluayA9PSBOVUxMKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAg
ICAgICAgICAgICAgICBOT0RFICp0ZW1wID0gcm9vdC0+bGxpbms7DQogICAgICAg
ICAgICAgICAgICAgICAgICBmcmVlKHJvb3QpOw0KICAgICAgICAgICAgICAgICAg
ICAgICAgcmV0dXJuIHRlbXA7DQogICAgICAgICAgICAgICAgICAgIH0NCi8vIG5v
ZGUgd2l0aCB0d28gY2hpbGRyZW46IEdldCB0aGUgaW5vcmRlciBzdWNjZXNzb3Ig
KHNtYWxsZXN0DQovLyBpbiB0aGUgcmlnaHQgc3VidHJlZSkNCiAgICAgICAgICAg
ICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIE5P
REUgKnRlbXAgPSBtaW5WYWx1ZU5vZGUocm9vdC0+cmxpbmspOw0KICAgICAgICAg
ICAgICAgIHJvb3QtPmluZm8gPSB0ZW1wLT5pbmZvOw0KICAgICAgICAgICAgICAg
IHJvb3QtPnJsaW5rID0gZGVsZXRlX2VsZW1lbnQocm9vdC0+cmxpbmssIHRlbXAt
PmluZm8pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAg
ICAgcmV0dXJuIHJvb3Q7DQp9DQoNCi8vKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKg0KDQppbnQgc2VhcmNoX2VsZW1lbnQoTk9E
RSAqcm9vdCxpbnQga2V5KQ0Kew0KICAgIE5PREUgKmN1cjsNCiAgICBpbnQgbj0w
Ow0KICAgIGN1cj1yb290Ow0KICAgIGlmIChjdXIhPU5VTEwpDQogICAgICAgIHsN
CiAgICAgICAgICAgIGlmIChrZXk9PWN1ci0+aW5mbykNCiAgICAgICAgICAgICAg
ICBuPTE7DQogICAgICAgICAgICBlbHNlIGlmIChrZXk8Y3VyLT5pbmZvKQ0KICAg
ICAgICAgICAgICAgIHJldHVybiBzZWFyY2hfZWxlbWVudChjdXItPmxsaW5rLGtl
eSk7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIHNl
YXJjaF9lbGVtZW50KGN1ci0+cmxpbmssa2V5KTsNCiAgICAgICAgfQ0KICAgICAg
ICBlbHNlDQogICAgICAgICAgICByZXR1cm4gbjsNCn0NCg0KLy8qKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCnZvaWQgaW5v
cmRlcihOT0RFICp4KQ0Kew0KICAgIGlmKHggIT0gTlVMTCkNCiAgICAgICAgew0K
ICAgICAgICAgICAgaW5vcmRlcih4LT5sbGluayk7DQogICAgICAgICAgICBwcmlu
dGYoIiVkIC4uLiAiLCB4LT5pbmZvKTsNCiAgICAgICAgICAgIGlub3JkZXIoeC0+
cmxpbmspOw0KICAgICAgICB9DQp9DQoNCi8vKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKg0KLy8qKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCnZvaWQgbWFpbigpDQp7DQog
ICAgaW50IGl0ZW0sY2gsa2V5LG4sIGEsIHg7DQogICAgTk9ERSAqcm9vdDsNCiAg
ICByb290ID0gTlVMTDsNCg0KICAgIHdoaWxlICgxKQ0KICAgIHsNCiAgICAgICAg
cHJpbnRmKCJcblxuRW50ZXIgdGhlIGNob2ljZVxuMS5NYXhpbXVtXG4yLk1pbmlt
dW1cbjMuSW5zZXJ0IGFuIEVsZW1lbnRcbjQuRGVsZXRlIGFuIEVsZW1lbnRcbjUu
U2VhcmNoIGFuIEVsZW1lbnRcbjA6RXhpdCIpOw0KICAgICAgICBwcmludGYoIlxu
XG5DaG9pY2U6ICIpOw0KICAgICAgICBzY2FuZigiJWQiLCZjaCk7DQogICAgICAg
IHN3aXRjaChjaCkNCiAgICAgICAgew0KDQogICAgICAgICAgICBjYXNlIDE6DQog
ICAgICAgICAgICAgICAgeCA9IG1heGltdW0ocm9vdCk7DQogICAgICAgICAgICAg
ICAgcHJpbnRmKCJcbm1heGltdW0gbnVtYmVyIGlzICVkXG4iLCB4KTsNCg0KICAg
ICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAyOg0KDQogICAg
ICAgICAgICAgICAgeCA9IG1pbmltdW0ocm9vdCk7DQogICAgICAgICAgICAgICAg
cHJpbnRmKCJcbm1pbmltdW0gbnVtYmVyIGlzICVkXG4iLCB4KTsNCg0KICAgICAg
ICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAzOiAvL2luc2VydA0K
ICAgICAgICAgICAgICAgICAgICBwcmludGYoIkVudGVyIHRoZSBlbGVtZW50czog
Iik7DQogICAgICAgICAgICAgICAgICAgIHNjYW5mKCIlZCIsJmEpOw0KICAgICAg
ICAgICAgICAgICAgICByb290PWluc2VydChyb290LCBhKTsNCg0KICAgICAgICAg
ICAgICAgICAgICBwcmludGYoIlxuIik7DQogICAgICAgICAgICAgICAgICAgIGlu
b3JkZXIocm9vdCk7IC8vSW5vcmRlciBTb3J0IFRyZWUNCg0KICAgICAgICAgICAg
ICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSA0OiAvL2RlbGV0ZQ0KICAgICAg
ICAgICAgICAgICAgICBpZiAocm9vdD09TlVMTCkNCiAgICAgICAgICAgICAgICAg
ICAgICAgIHByaW50ZigiTGlzdCBFbXB0eVxuIik7DQogICAgICAgICAgICAgICAg
ICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAg
ICAgICAgICAgcHJpbnRmKCJFbnRlciB0aGUgZWxlbWVudDogIik7DQogICAgICAg
ICAgICAgICAgICAgICAgICBzY2FuZigiJWQiLCZrZXkpOw0KICAgICAgICAgICAg
ICAgICAgICAgICAgbj1zZWFyY2hfZWxlbWVudChyb290LGtleSk7DQogICAgICAg
ICAgICAgICAgICAgIGlmKG4pDQogICAgICAgICAgICAgICAgICAgICAgICByb290
PWRlbGV0ZV9lbGVtZW50KHJvb3Qsa2V5KTsNCiAgICAgICAgICAgICAgICAgICAg
ZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCJOb3QgZm91bmRc
biIpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAg
ICAgcHJpbnRmKCJcbiIpOw0KICAgICAgICAgICAgICAgICAgICBpbm9yZGVyKHJv
b3QpOyAvL0lub3JkZXIgU29ydCBUcmVlDQoNCiAgICAgICAgICAgICAgICBicmVh
azsNCiAgICAgICAgICAgIGNhc2UgNTogLy9zZWFyY2gNCiAgICAgICAgICAgICAg
ICAgICAgaWYgKHJvb3Q9PU5VTEwpDQogICAgICAgICAgICAgICAgICAgICAgICBw
cmludGYoIkxpc3QgRW1wdHlcbiIpOw0KICAgICAgICAgICAgICAgICAgICBlbHNl
DQogICAgICAgICAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgICAgICAg
ICAgcHJpbnRmKCJFbnRlciB0aGUgZWxlbWVudDogIik7DQogICAgICAgICAgICAg
ICAgICAgICAgICBzY2FuZigiJWQiLCZrZXkpOw0KICAgICAgICAgICAgICAgICAg
ICAgICAgbj1zZWFyY2hfZWxlbWVudChyb290LGtleSk7DQogICAgICAgICAgICAg
ICAgICAgICAgICBpZihuKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBy
aW50ZigiXG5OdW1iZXItRm91bmRcbiIpOw0KICAgICAgICAgICAgICAgICAgICAg
ICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZigiXG5O
b3QtRm91bmRcbiIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAg
ICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDA6IC8vZXhpdA0KICAgICAg
ICAgICAgICAgIGV4aXQoMCk7DQogICAgICAgICAgICBkZWZhdWx0OiBwcmludGYo
IlxuV3JvbmcgQ2hvaWNlXG4iKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg==
